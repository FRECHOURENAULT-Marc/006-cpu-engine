#pragma once

class Game : public cpu_engine
{
public:
	Game();
	virtual ~Game();

	void Enter();
	void Execute();
	void Exit();
	cpu_fsm<Game>* GetFSM() { return m_pFSM; }

	void OnStart() override;
	void OnUpdate() override;
	void OnExit() override;
	void OnPreRender() override;
	void OnPostRender() override;

	static void MyPixelShader(cpu_ps_io& io);

private:

	// Resources
	cpu_font m_font;
	cpu_mesh m_meshShip;
	cpu_mesh m_meshMissile;
	cpu_mesh m_meshSphere;
	cpu_texture m_texture;

	// UI
	cpu_sprite* m_pSprite;

	// Shader
	cpu_material m_materialShip;
	cpu_material m_materialMissile;

	// 3D
	cpu_entity* m_pShip;
	std::list<cpu_entity*> m_missiles;
	float m_missileSpeed;
	cpu_entity* m_pBall;

	// Gameplay
	cpu_fsm<Game>* m_pFSM;
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct StateLoad : public cpu_state<Game>
{
	static void OnEnter(Game& game, int from);
	static void OnExecute(Game& game);
	static void OnExit(Game& game, int to);
	static inline int id;
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct StatePlay : public cpu_state<Game>
{
	static void OnEnter(Game& game, int from);
	static void OnExecute(Game& game);
	static void OnExit(Game& game, int to);
	static inline int id;
};
